<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»¿çœŸè§„åˆ’æœåŠ¡</title>
    <style>
        :root {
            --bg-color: #f7f8fa;
            --primary-color: #262626;
            --secondary-color: #eff1f6;
            --text-color: #262626;
            --panel-bg: #ffffff;
            --border-color: #e5e5e5;
            --accent-color: #007bff;
        }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            background-image: none; /* Clean background */
        }
        .container { 
            max-width: 1200px; 
            margin: 20px auto; 
            border: none;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
            padding: 24px;
            background: var(--panel-bg);
            position: relative;
            min-height: 800px;
            border-radius: 8px;
        }
        /* Status bar removed */
        h1 {
            color: var(--primary-color);
            font-size: 24px;
            border-bottom: none;
            padding-bottom: 0;
            margin-bottom: 20px;
            font-weight: 600;
            letter-spacing: normal;
        }
        h2 {
            color: var(--primary-color);
            text-transform: none;
            font-size: 18px;
            border-left: none;
            padding-left: 0;
            margin-top: 0;
            font-weight: 600;
        }
        h3 {
            color: #595959;
            font-size: 14px;
            text-transform: none;
            margin-bottom: 8px;
            font-weight: 500;
        }
        .section { 
            display: none; 
            border: none; 
            padding: 0; 
            margin-top: 20px; 
            background: #fff;
            position: relative;
            border-radius: 0;
            box-shadow: none;
        }
        
        /* New layout for Service Section */
        #service.active {
            display: flex;
            flex-direction: column;
            gap: 20px;
            border: none;
            background: none;
            padding: 0;
        }
        
        .sidebar {
            width: 100%;
            flex-shrink: 0;
            display: flex;
            flex-direction: row;
            gap: 8px;
            border-right: none;
            border-bottom: 1px solid var(--border-color);
            padding-right: 0;
            padding-bottom: 0;
            overflow-x: auto;
            margin-bottom: 20px;
        }
        
        .sidebar button {
            width: auto;
            text-align: center;
            padding: 8px 16px;
            font-size: 14px;
            white-space: nowrap;
            flex-shrink: 0;
            border: none;
            background: transparent;
            color: #595959;
            border-radius: 4px;
            font-weight: 500;
            box-shadow: none;
            text-transform: none;
            letter-spacing: normal;
        }
        
        .sidebar button:hover:not(:disabled) {
            background: rgba(0,0,0,0.04);
            color: var(--primary-color);
            box-shadow: none;
            border-color: transparent;
        }

        .sidebar button.active-tab {
            background: #262626; /* Dark active state like reference tags */
            color: #fff;
            box-shadow: none;
            border: none;
            border-radius: 20px; /* Pill shape */
        }

        .content-area {
            flex-grow: 1;
            border: none;
            padding: 0;
            background: transparent;
            min-height: auto;
            position: relative;
        }
        
        .sub-section {
            display: none;
            animation: fadeIn 0.3s;
        }
        .sub-section.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .section::after {
            content: "";
            position: absolute;
            bottom: -1px;
            right: -1px;
            width: 20px;
            height: 20px;
            border-bottom: 2px solid var(--primary-color);
            border-right: 2px solid var(--primary-color);
        }
        .active { 
            display: block; 
            animation: slideIn 0.3s ease-out;
        }
        .content-area {
            flex-grow: 1;
            padding: 30px;
            background-color: #ffffff;
            position: relative;
            overflow: hidden;
            border-radius: 0 8px 8px 0;
        }
        
        /* 3D Digital Terrain Effect removed */
        /* Abstract Digital Hills/Topography removed */


        .sub-section {
            position: relative;
            z-index: 1; /* Ensure content is above background effects */
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .nav { margin-bottom: 30px; display: flex; gap: 10px; }
        
        button { 
            padding: 10px 25px; 
            cursor: pointer; 
            background: #fff;
            border: 1px solid var(--border-color);
            color: var(--primary-color);
            font-family: inherit;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
            border-radius: 4px;
            font-weight: 600;
        }
        button:hover:not(:disabled) {
            background: var(--primary-color);
            color: #fff;
            border-color: var(--primary-color);
            box-shadow: 0 4px 12px rgba(0, 102, 204, 0.2);
        }
        button:disabled {
            border-color: #eee;
            color: #aaa;
            cursor: not-allowed;
            background: #f9f9f9;
        }
        
        input { 
            padding: 10px; 
            margin: 5px; 
            width: 200px; 
            background: #fff;
            border: 1px solid var(--border-color);
            border-left: 2px solid var(--border-color);
            color: #333;
            font-family: 'Consolas', monospace;
            transition: all 0.3s;
            border-radius: 4px;
        }
        input:focus {
            outline: none;
            border-color: var(--primary-color);
            border-left-width: 4px;
            box-shadow: 0 2px 8px rgba(0, 102, 204, 0.1);
        }

        #map-area { 
            height: 400px; 
            background-color: #f8fbff; 
            margin-top: 20px; 
            position: relative; 
            border: 1px solid var(--border-color);
            box-shadow: inset 0 0 20px rgba(0, 102, 204, 0.05);
            border-radius: 4px;
        }
        /* Grid overlay removed */


        .log { 
            background: #fff; 
            padding: 15px; 
            font-family: 'Consolas', monospace; 
            margin-top: 15px; 
            border: 1px solid var(--border-color);
            color: #333;
            max-height: 200px;
            overflow-y: auto;
            border-radius: 4px;
        }
        .log::-webkit-scrollbar { width: 8px; }
        .log::-webkit-scrollbar-track { background: #f0f0f0; }
        .log::-webkit-scrollbar-thumb { background: #ccc; border-radius: 4px; }

        .obstacle-row {
            display: flex;
            align-items: center;
            background: #f9f9f9;
            margin-bottom: 8px;
            padding: 8px;
            border-left: 3px solid var(--accent-color);
            border-radius: 4px;
            border: 1px solid #eee;
            border-left-width: 3px;
        }
        .remove-btn {
            border-color: #ffcccc;
            color: #cc0000;
            padding: 5px 12px;
            margin-left: 10px;
            font-size: 12px;
            background: #fff5f5;
        }
        .remove-btn:hover {
            background: #cc0000;
            color: #fff;
            border-color: #cc0000;
            box-shadow: none;
        }
        
        .coordinates-group {
            background: #f8fbff;
            padding: 20px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            margin-bottom: 20px;
        }
        
        /* New Form Layout System */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-size: 12px;
            font-weight: 600;
            color: #555;
            margin-bottom: 6px;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box; /* Important for grid */
            margin: 0;
            font-family: 'Consolas', monospace;
        }
        
        .form-group input:focus, .form-group select:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 2px rgba(0, 102, 204, 0.1);
        }

        /* Dynamic List Styling */
        .list-container {
            border: 1px solid #eee;
            background: #fafafa;
            padding: 10px;
            border-radius: 4px;
            min-height: 50px;
            max-height: 300px;
            overflow-y: auto;
        }

        .list-header {
            display: grid;
            gap: 10px;
            padding: 8px 12px;
            margin-bottom: 5px;
            font-size: 13px;
            font-weight: 600;
            color: #666;
            background: #f1f3f5;
            border-radius: 4px;
            align-items: center;
        }

        .obstacle-row {
            display: grid;
            gap: 10px;
            align-items: center;
            background: #fff;
            padding: 8px 12px;
            margin-bottom: 8px;
            border: 1px solid #e0e0e0;
            border-left: 3px solid var(--secondary-color);
            border-radius: 4px;
            transition: transform 0.1s, box-shadow 0.1s;
        }
        
        .obstacle-row:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        /* Grid definitions for different row types - will be used by JS */
        .grid-2-cols { grid-template-columns: 1fr 1fr auto; }
        .grid-3-cols { grid-template-columns: 1fr 1fr 1fr auto; }
        .grid-4-cols { grid-template-columns: 1fr 1fr 1fr 1fr auto; }
        .grid-5-cols { grid-template-columns: 1fr 1fr 1fr 1fr 1fr auto; }
        .grid-task   { grid-template-columns: 0.6fr 1.2fr 0.8fr 0.8fr 0.8fr auto; }

        .obstacle-row input {
            width: 100%;
            padding: 6px;
            border: 1px solid #ddd;
            border-radius: 3px;
            box-sizing: border-box;
            margin: 0;
        }

        .remove-btn {
            background: #fff0f0;
            color: #d32f2f;
            border: 1px solid #ffcdd2;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            white-space: nowrap;
            width: auto;
            margin: 0;
        }
        .remove-btn:hover {
            background: #d32f2f;
            color: white;
            border-color: #b71c1c;
        }

        .action-bar {
            display: flex;
            gap: 12px;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #eee;
            flex-wrap: wrap;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 20px;
            padding: 8px 20px;
            font-size: 14px;
            font-weight: 500;
            box-shadow: none;
        }
        .btn-primary:hover { 
            background-color: #000; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn-outline {
            background: white;
            border: 1px solid #d9d9d9;
            color: #595959;
            border-radius: 20px;
            padding: 8px 20px;
            font-size: 14px;
            font-weight: 500;
        }
        .btn-outline:hover {
            border-color: #262626;
            color: #262626;
        }
        
        /* Section Headers inside tabs */
        h3 {
            font-size: 14px;
            color: #444;
            border-bottom: 1px solid #eee;
            padding-bottom: 8px;
            margin: 20px 0 10px 0;
        }

        /* Hide original input-label if needed, or repurpose */
        .input-label-inline {
            font-size: 11px;
            color: #888;
            margin-right: 5px;
            display: none; /* Hidden in grid layout as we use placeholders or headers */
        }
        /* Login Card specific styles */
        #login {
            max-width: 400px;
            margin: 50px auto;
            padding: 40px;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
            border: none;
        }

        #login h2 {
            display: none; /* Hide default section header */
        }

        .login-tabs {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            border-bottom: none;
        }

        .login-tab {
            font-size: 18px;
            color: #999;
            cursor: pointer;
            padding-bottom: 8px;
            font-weight: 500;
            position: relative;
        }

        .login-tab.active {
            color: #333;
            font-weight: 700;
        }

        .login-tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 30px;
            height: 3px;
            background: var(--primary-color);
            border-radius: 2px;
        }

        .login-input {
            width: 100%;
            padding: 12px 0;
            border: none;
            border-bottom: 1px solid #eee;
            margin-bottom: 20px;
            font-size: 14px;
            outline: none;
            transition: border-color 0.3s;
            font-family: inherit;
            border-radius: 0;
            box-shadow: none;
        }

        .login-input:focus {
            border-bottom-color: var(--primary-color);
            box-shadow: none;
        }

        .btn-login-submit {
            width: 100%;
            padding: 12px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
            box-shadow: none;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn-login-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            background: #000;
        }

        .login-links {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            font-size: 12px;
            color: #999;
        }

        .login-links span {
            cursor: pointer;
        }

        .login-links span:hover {
            color: #666;
        }

        .section-icon {
            display: inline-block;
            width: 24px;
            height: 24px;
            margin-right: 8px;
            vertical-align: middle;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }

        /* SVG Icons encoded as data URIs for simplicity */
        .icon-path { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23262626'%3E%3Cpath d='M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z'/%3E%3C/svg%3E"); }
        .icon-search { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23262626'%3E%3Cpath d='M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z'/%3E%3C/svg%3E"); }
        .icon-buoy { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23262626'%3E%3Cpath d='M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z'/%3E%3C/svg%3E"); }
        .icon-formation { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23262626'%3E%3Cpath d='M4 11h5V5H4v6zm0 7h5v-6H4v6zm6 0h5v-6h-5v6zm6 0h5v-6h-5v6zm-6-7h5V5h-5v6zm6-6v6h5V5h-5z'/%3E%3C/svg%3E"); }
        .icon-intercept { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23262626'%3E%3Cpath d='M12 2L4.5 20.29l.71.71L12 18l6.79 3 .71-.71z'/%3E%3C/svg%3E"); }
        .sea-map { height: 420px; border: 1px solid var(--border-color); border-radius: 6px; margin-top: 20px; position: relative; z-index: 1; }

        /* Chat Specific Styles */
        /* Hide Sea Map when Chat tab is active */
        #tab-chat.active ~ #map-area {
            display: none !important;
        }

        #tab-chat {
            height: 600px; /* Fixed height or flex */
            flex-direction: column;
            position: relative;
            background-color: #fff;
            background-image: 
                linear-gradient(#f8f8f8 1px, transparent 1px),
                linear-gradient(90deg, #f8f8f8 1px, transparent 1px);
            background-size: 30px 30px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        #tab-chat.active {
            display: flex;
        }

        .chat-main-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
        }

        .chat-scroll-view {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            scroll-behavior: smooth;
        }

        .chat-message {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            animation: fadeIn 0.3s ease;
        }

        .chat-message.user {
            flex-direction: row-reverse;
        }

        .chat-message.user .message-content {
            background-color: var(--primary-color);
            color: #fff;
            border-radius: 12px 12px 0 12px;
            padding: 10px 16px;
            max-width: 80%;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .chat-message.assistant {
            flex-direction: row;
        }

        .chat-message.assistant .message-content {
            background-color: #fff;
            border: 1px solid #eee;
            border-radius: 0 12px 12px 12px;
            padding: 12px 18px;
            max-width: 85%;
            line-height: 1.6;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .suggestion-float-container {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 10px;
            z-index: 10;
            pointer-events: none; /* Let clicks pass through if needed, but buttons need pointer-events auto */
        }

        .suggestion-chip {
            pointer-events: auto;
            background: #fff;
            border: 1px solid #eee;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 13px;
            color: #555;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .suggestion-chip:hover {
            border-color: var(--primary-color);
            color: var(--primary-color);
            transform: translateX(-5px);
        }

        .chat-input-section {
            padding: 20px;
            background: rgba(255,255,255,0.8);
            backdrop-filter: blur(5px);
            border-top: 1px solid #eee;
        }

        .chat-input-box {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 12px;
            padding: 10px 15px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .chat-input-box:focus-within {
            border-color: var(--primary-color);
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
        }

        #chat-input {
            width: 100%;
            border: none;
            background: transparent;
            resize: none;
            outline: none;
            font-size: 15px;
            line-height: 1.5;
            max-height: 150px;
            font-family: inherit;
        }

        .chat-toolbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-tools {
            display: flex;
            gap: 8px;
        }

        .tool-chip {
            font-size: 12px;
            padding: 4px 10px;
            background: #f5f5f5;
            border-radius: 4px;
            color: #666;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
            border: 1px solid transparent;
            transition: all 0.2s;
        }

        .tool-chip:hover {
            background: #e6f4ff;
            color: #007bff;
        }

        .tool-chip.active {
            background: #e6f4ff;
            color: #007bff;
            border-color: #007bff;
        }

        .send-btn {
            background: var(--primary-color);
            color: #fff;
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background 0.2s;
        }

        .send-btn:hover {
            background: #000;
        }
    </style>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body> 
    <div class="container">
        <h1>ä»¿çœŸè§„åˆ’æœåŠ¡</h1>
        
        <div class="nav">
            <button onclick="showSection('login')" id="btn-login" style="display:none;">ç™»å½•/æ³¨å†Œ</button>
        </div>

        <!-- Login Module -->
        <div id="login" class="section active">
            <div class="login-tabs">
                <div id="tab-account" class="login-tab active" onclick="switchLoginMode('account')">è´¦å·ç™»å½•</div>
                <div id="tab-google" class="login-tab" onclick="switchLoginMode('google')">Google ç™»å½•</div>
            </div>

            <div id="login-account-view">
                <input type="text" id="username" class="login-input" placeholder="è´¦å·å/é‚®ç®±/æ‰‹æœºå·" value="admin">
                <input type="password" id="password" class="login-input" placeholder="è¯·è¾“å…¥ç™»å½•å¯†ç " value="123456">
                
                <button onclick="login()" class="btn-login-submit">ç™» å½•</button>
                
                <div class="login-links">
                    <span>å¿˜è®°å¯†ç </span>
                    <span>|</span>
                    <span>å¿˜è®°è´¦å·å</span>
                    <span>|</span>
                    <span onclick="register()" style="color: #666;">å…è´¹æ³¨å†Œ</span>
                </div>
            </div>

            <div id="login-google-view" style="display: none;">
                <div id="buttonDiv" style="display: flex; justify-content: center;"></div>
                <div style="text-align: center; margin-top: 20px; font-size: 12px; color: #999;">
                    å®‰å…¨å¿«æ·ï¼Œæ— éœ€æ³¨å†Œ
                </div>
            </div>

            <div id="login-msg" style="margin-top: 20px; text-align: center; color: #d32f2f; font-size: 13px;"></div>
        </div>

        <!-- Service Module -->
        <div id="service" class="section">
            <div class="sidebar">
                <button onclick="switchTab('path')" class="active-tab">é¿éšœèˆªè·¯è§„åˆ’</button>
                <button onclick="switchTab('search')">æœç´¢èˆªè·¯è§„åˆ’</button>
                <button onclick="switchTab('buoy')">æµ®æ ‡é˜µå‹è§„åˆ’</button>
                <button onclick="switchTab('formation')">ç¼–é˜Ÿé˜µå‹è§„åˆ’</button>
                <button onclick="switchTab('intercept')">æ‹¦æˆªèˆªè·¯è§„åˆ’</button>
                <button onclick="switchTab('chat')">æ™ºèƒ½è¯¢é—®</button>
            </div>
            
            <div class="content-area">
                <!-- Path Planning (Original) -->
                <div id="tab-path" class="sub-section active">
                    <h2><span class="section-icon icon-path"></span>é¿éšœèˆªè·¯è§„åˆ’ç®—æ³•æœåŠ¡</h2>
                    <p style="color: #666; font-size: 14px; margin-bottom: 15px;">è¾“å…¥åœ†å¿ƒåæ ‡ã€åŠå¾„ã€èµ·ç‚¹å’Œç»ˆç‚¹ã€‚</p>
                    
                    <div class="coordinates-group">
                        <div class="form-grid" style="grid-template-columns: 1fr 1fr;">
                            <div class="form-group">
                                <label>èµ·ç‚¹</label>
                                <div style="display: flex; gap: 5px;">
                                    <input type="number" id="start-lat" placeholder="çº¬åº¦">
                                    <input type="number" id="start-lon" placeholder="ç»åº¦">
                                    <button type="button" class="btn-outline" style="padding:4px 8px; min-width: 50px;" onclick="pickPoint('start-lat', 'start-lon')">é€‰ç‚¹</button>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>ç»ˆç‚¹</label>
                                <div style="display: flex; gap: 5px;">
                                    <input type="number" id="end-lat" placeholder="çº¬åº¦">
                                    <input type="number" id="end-lon" placeholder="ç»åº¦">
                                    <button type="button" class="btn-outline" style="padding:4px 8px; min-width: 50px;" onclick="pickPoint('end-lat', 'end-lon')">é€‰ç‚¹</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <h3>éšœç¢ç‰© (åœ†å½¢)</h3>
                    <div class="list-header" style="display: grid; grid-template-columns: 1fr 1fr 0.5fr 1fr auto; gap: 10px;">
                        <span>çº¬åº¦</span><span>ç»åº¦</span><span>é€‰ç‚¹</span><span>åŠå¾„(m)</span><span>æ“ä½œ</span>
                    </div>
                    <div id="obs-list" class="list-container">
                        <!-- Dynamic List -->
                    </div>
                    
                    <div class="action-bar">
                        <button onclick="addObstacleRow()" class="btn-outline">+ æ·»åŠ éšœç¢ç‰©</button>
                        <button onclick="showPathExample()" class="btn-outline">ç”¨ä¾‹</button>
                        <button onclick="planPath()" class="btn-primary">è®¡ç®—è·¯å¾„</button>
                    </div>
                    
                    <div id="path-result" class="log" style="display: none;"></div>
                </div>

                <!-- Map Area moved to bottom -->

                <!-- Placeholders for other tabs -->
                <div id="tab-search" class="sub-section">
                    <h2><span class="section-icon icon-search"></span>æœç´¢èˆªè·¯è§„åˆ’</h2>
                    <div class="coordinates-group">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>åŒºåŸŸä¸­å¿ƒ</label>
                                <div style="display: flex; gap: 5px;">
                                    <input type="number" id="search-center-lat" placeholder="çº¬åº¦">
                                    <input type="number" id="search-center-lon" placeholder="ç»åº¦">
                                    <button type="button" class="btn-outline" style="padding:4px 8px; min-width: 50px;" onclick="pickPoint('search-center-lat', 'search-center-lon')">é€‰ç‚¹</button>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>åŒºåŸŸå®½åº¦ (km)</label>
                                <input type="number" id="search-width-km" value="60">
                            </div>
                            <div class="form-group">
                                <label>åŒºåŸŸé«˜åº¦ (km)</label>
                                <input type="number" id="search-height-km" value="40">
                            </div>
                        </div>
                    </div>
                    <div class="coordinates-group">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>æ¢æµ‹åŠå¾„ (m)</label>
                                <input type="number" id="search-range" value="200000">
                            </div>
                            <div class="form-group">
                                <label>èˆªçº¿æ–¹å‘ (åº¦)</label>
                                <input type="number" id="search-heading" value="90">
                            </div>
                            <div class="form-group">
                                <label>è¦†ç›–ç³»æ•° (0.7-1.0)</label>
                                <input type="number" id="search-overlap" value="0.9" step="0.05">
                            </div>
                            <div class="form-group">
                                <label>å…µåŠ›æ•°é‡</label>
                                <input type="number" id="search-troops" value="2">
                            </div>
                        </div>
                    </div>
                    <div class="coordinates-group">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>èµ·ç‚¹</label>
                                <div style="display: flex; gap: 5px;">
                                    <input type="number" id="search-start-lat" placeholder="çº¬åº¦">
                                    <input type="number" id="search-start-lon" placeholder="ç»åº¦">
                                    <button type="button" class="btn-outline" style="padding:4px 8px; min-width: 50px;" onclick="pickPoint('search-start-lat', 'search-start-lon')">é€‰ç‚¹</button>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>ç»ˆç‚¹</label>
                                <div style="display: flex; gap: 5px;">
                                    <input type="number" id="search-end-lat" placeholder="çº¬åº¦">
                                    <input type="number" id="search-end-lon" placeholder="ç»åº¦">
                                    <button type="button" class="btn-outline" style="padding:4px 8px; min-width: 50px;" onclick="pickPoint('search-end-lat', 'search-end-lon')">é€‰ç‚¹</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="action-bar">
                        <button onclick="showSearchExample()" class="btn-outline">ç”¨ä¾‹</button>
                        <button onclick="planSearchRoute()" class="btn-primary">ç”Ÿæˆæœç´¢èˆªè·¯</button>
                    </div>
                    <div id="search-result" class="log" style="display: none;"></div>
                    <!-- canvas removed -->
                    <h3>ç»“æœæ•°ç»„</h3>
                    <div id="search-routes-json" class="log"></div>
                </div>
                <div id="tab-buoy" class="sub-section">
                    <h2><span class="section-icon icon-buoy"></span>æµ®æ ‡é˜µå‹è§„åˆ’</h2>
                    <div class="coordinates-group">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>ä¸­å¿ƒ çº¬åº¦</label>
                                <div style="display: flex; gap: 5px;">
                                    <input type="number" id="buoy-center-lat" value="39.9">
                                    <input type="number" id="buoy-center-lon" value="116.4">
                                    <button type="button" class="btn-outline" style="padding:4px 8px; min-width: 50px;" onclick="pickPoint('buoy-center-lat', 'buoy-center-lon')">é€‰ç‚¹</button>
                                </div>
                            </div>
                            <div class="form-group" id="group-rows">
                                <label id="label-rows">è¡Œæ•°</label>
                                <input type="number" id="buoy-rows" value="3">
                            </div>
                            <div class="form-group" id="group-cols">
                                <label id="label-cols">åˆ—æ•°</label>
                                <input type="number" id="buoy-cols" value="4">
                            </div>
                            <div class="form-group" id="group-radius" style="display:none;">
                                <label id="label-radius">åŠå¾„ (m)</label>
                                <input type="number" id="buoy-radius" value="1000">
                            </div>
                            <div class="form-group" id="group-angle" style="display:none;">
                                <label id="label-angle">è§’åº¦ (Â°)</label>
                                <input type="number" id="buoy-angle" value="0">
                            </div>
                            <div class="form-group" id="group-angle-span" style="display:none;">
                                <label id="label-angle-span">å¼€å£è§’åº¦ (Â°)</label>
                                <input type="number" id="buoy-angle-span" value="90">
                            </div>
                            <div class="form-group" id="group-spacing">
                                <label id="label-spacing">é—´è· (m)</label>
                                <input type="number" id="buoy-spacing" value="5000">
                            </div>
                            <div class="form-group">
                                <label>ç±»å‹</label>
                                <select id="buoy-type" onchange="updateBuoyUI()">
                                    <option value="grid">ç½‘æ ¼é˜µå‹</option>
                                    <option value="circle">åœ†å½¢é˜µå‹</option>
                                    <option value="sector">æ‰‡å½¢é˜µå‹</option>
                                    <option value="expanding_circle">åœ†å½¢æ‰©å±•é˜µ</option>
                                    <option value="expanding_rect">çŸ©å½¢æ‰©å±•é˜µ</option>
                                    <option value="line">ç›´çº¿æ‹¦æˆªé˜µ</option>
                                    <option value="multi_line">å¤šç›´çº¿é˜µ</option>
                                    <option value="cross_line">åŒç›´çº¿äº¤å‰é˜µ</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="action-bar">
                        <button onclick="showBuoyExample()" class="btn-outline">ç”¨ä¾‹</button>
                        <button onclick="planBuoyFormation()" class="btn-primary">ç”Ÿæˆé˜µå‹</button>
                        <button onclick="planBuoyRoute()" class="btn-primary">ç”ŸæˆæŠ•æ”¾èˆªè·¯</button>
                    </div>
                    <div id="buoy-result" class="log"></div>
                    <!-- <canvas id="buoyCanvas" width="760" height="300" style="margin-top:15px;"></canvas> -->
                    <div id="buoy-route-result" class="log"></div>
                    <!-- <canvas id="buoyRouteCanvas" width="760" height="300" style="margin-top:15px;"></canvas> -->
                </div>
                <div id="tab-formation" class="sub-section">
                    <h2><span class="section-icon icon-formation"></span>ç¼–é˜Ÿé˜µå‹è§„åˆ’</h2>
                    <div class="coordinates-group">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>é¢†é˜Ÿçº¬åº¦</label>
                                <div style="display: flex; gap: 5px;">
                                    <input type="number" id="formation-leader-lat" value="39.9">
                                    <input type="number" id="formation-leader-lon" value="116.4">
                                    <button type="button" class="btn-outline" style="padding:4px 8px; min-width: 50px;" onclick="pickPoint('formation-leader-lat', 'formation-leader-lon')">é€‰ç‚¹</button>
                                </div>
                            </div>
                            <div class="form-group" id="form-group-n">
                                <label id="label-form-n">æ•°é‡</label>
                                <input type="number" id="formation-n" value="6">
                            </div>
                            <div class="form-group" id="form-group-spacing">
                                <label id="label-form-spacing">é—´è· (m)</label>
                                <input type="number" id="formation-spacing" value="200">
                            </div>
                            <div class="form-group" id="form-group-angle" style="display:none;">
                                <label id="label-form-angle">æ–¹å‘ (Â°)</label>
                                <input type="number" id="formation-angle" value="0">
                            </div>
                             <div class="form-group" id="form-group-angle-span" style="display:none;">
                                <label id="label-form-angle-span">å¤¹è§’ (Â°)</label>
                                <input type="number" id="formation-angle-span" value="60">
                            </div>
                            <div class="form-group">
                                <label>ç±»å‹</label>
                                <select id="formation-type" onchange="updateFormationUI()">
                                    <option value="line">æ¨ªé˜Ÿ (Line)</option>
                                    <option value="column">çºµé˜Ÿ (Column)</option>
                                    <option value="wedge">æ¥”å½¢ (Wedge)</option>
                                    <option value="echelon_right">å³æ¢¯é˜Ÿ (Echelon R)</option>
                                    <option value="echelon_left">å·¦æ¢¯é˜Ÿ (Echelon L)</option>
                                    <option value="circle">åœ†å½¢ (Circle)</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="action-bar">
                        <button onclick="showFormationExample()" class="btn-outline">ç”¨ä¾‹</button>
                        <button onclick="planFormation()" class="btn-primary">ç”Ÿæˆç¼–é˜Ÿ</button>
                        <button onclick="planFormationRoute()" class="btn-primary">ç”ŸæˆæŠ•æ”¾èˆªè·¯</button>
                    </div>
                    
                    <div id="formation-result" class="log"></div>
                    <!-- <canvas id="formationCanvas" width="760" height="300" style="margin-top:15px;"></canvas> -->
                    <div id="formation-route-result" class="log"></div>
                    <!-- <canvas id="formationRouteCanvas" width="760" height="300" style="margin-top:15px;"></canvas> -->
                </div>
                <div id="tab-intercept" class="sub-section">
                    <h2><span class="section-icon icon-intercept"></span>æ‹¦æˆªèˆªè·¯è§„åˆ’</h2>
                    <div class="coordinates-group">
                        <h3>ç›®æ ‡ä¿¡æ¯ (è“è‰²)</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>çº¬åº¦</label>
                                <div style="display: flex; gap: 5px;">
                                    <input type="number" id="target-lat" value="39.5">
                                    <button type="button" class="btn-outline" style="padding:4px 8px; min-width: 50px;" onclick="pickPoint('target-lat', 'target-lon')">é€‰ç‚¹</button>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>ç»åº¦</label>
                                <input type="number" id="target-lon" value="116.0">
                            </div>
                            <div class="form-group">
                                <label>é€Ÿåº¦ (m/s)</label>
                                <input type="number" id="target-speed" value="200">
                            </div>
                            <div class="form-group">
                                <label>èˆªå‘ (åº¦)</label>
                                <input type="number" id="target-heading" value="45">
                            </div>
                        </div>
                    </div>
                    
                    <div class="coordinates-group">
                        <h3>æ‹¦æˆªæ–¹ä¿¡æ¯ (çº¢è‰²)</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>çº¬åº¦</label>
                                <div style="display: flex; gap: 5px;">
                                    <input type="number" id="interceptor-lat" value="40.0">
                                    <button type="button" class="btn-outline" style="padding:4px 8px; min-width: 50px;" onclick="pickPoint('interceptor-lat', 'interceptor-lon')">é€‰ç‚¹</button>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>ç»åº¦</label>
                                <input type="number" id="interceptor-lon" value="116.5">
                            </div>
                            <div class="form-group">
                                <label>æœ€å¤§é€Ÿåº¦ (m/s)</label>
                                <input type="number" id="interceptor-speed" value="300">
                            </div>
                        </div>
                    </div>
                    <div class="coordinates-group">
                        <h3>é«˜çº§å‚æ•°</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>ç›®æ ‡èˆªå‘å˜åŒ–ç‡ (åº¦/ç§’)</label>
                                <input type="number" id="target-heading-rate" value="0">
                            </div>
                            <div class="form-group">
                                <label>æ‹¦æˆªæ–¹æœ€å¤§è½¬å¼¯ç‡ (åº¦/ç§’)</label>
                                <input type="number" id="interceptor-turn-rate" value="10">
                            </div>
                            <div class="form-group">
                                <label>æ­¥é•¿ dt (ç§’)</label>
                                <input type="number" id="intercept-dt" value="5">
                            </div>
                            <div class="form-group">
                                <label>æœ€å¤§æ—¶é—´ tmax (ç§’)</label>
                                <input type="number" id="intercept-tmax" value="3600">
                            </div>
                        </div>
                    </div>
                    <div class="coordinates-group">
                        <h3>éšœç¢ä¸å¤šç›®æ ‡</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>éšœç¢ç‰© (lat,lon,r;...)</label>
                                <input type="text" id="intercept-obstacles" value="39.7,116.3,50000" oninput="updateInterceptPreview()">
                                <div style="margin-top: 5px; display: flex; gap: 5px; align-items: center;">
                                    <input type="number" id="obs-add-lat" placeholder="çº¬åº¦" style="width: 70px;">
                                    <input type="number" id="obs-add-lon" placeholder="ç»åº¦" style="width: 70px;">
                                    <button type="button" class="btn-outline" style="padding:4px 8px;" onclick="pickPoint('obs-add-lat', 'obs-add-lon')">é€‰ç‚¹</button>
                                    <input type="number" id="obs-add-rad" placeholder="åŠå¾„" value="50000" style="width: 70px;">
                                    <button type="button" class="btn-primary" style="padding:4px 8px;" onclick="addInterceptObstacle()">æ·»åŠ </button>
                                    <button type="button" class="btn-outline" style="padding:4px 8px;" onclick="document.getElementById('intercept-obstacles').value=''; updateInterceptPreview()">æ¸…ç©º</button>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>å¤šç›®æ ‡ (lat,lon,speed,heading;...)</label>
                                <input type="text" id="intercept-multi-targets" placeholder="">
                            </div>
                        </div>
                    </div>

                    <div class="action-bar">
                        <button onclick="showInterceptExample()" class="btn-outline">ç”¨ä¾‹</button>
                        <button onclick="planIntercept()" class="btn-primary">è®¡ç®—æ‹¦æˆª</button>
                    </div>
                    
                    <div id="intercept-result" class="log"></div>
                    <!-- <canvas id="interceptCanvas" width="760" height="400" style="margin-top:15px;"></canvas> -->
                </div>
                <div id="tab-chat" class="sub-section">
                    <div class="chat-main-area">
                        <!-- Floating Suggestions (Top Right) -->
                        <div class="suggestion-float-container" id="chat-suggestions">
                        </div>

                        <!-- Chat Messages -->
                        <div id="chat-messages" class="chat-scroll-view">
                            <!-- Messages go here -->
                        </div>
                        
                        <!-- Input Area -->
                        <div class="chat-input-section">
                            <div class="chat-input-box">
                                <textarea id="chat-input" rows="1" oninput="this.style.height = ''; this.style.height = Math.min(this.scrollHeight, 150) + 'px'"></textarea>
                                <div class="chat-toolbar">
                                    <div class="chat-tools">
                                        <button class="tool-chip" onclick="toggleChip(this, 'deepthink')">
                                            <span class="icon-sparkles">âœ¨</span> æ·±åº¦æ€è€ƒ
                                        </button>
                                        <button class="tool-chip" onclick="toggleChip(this, 'search')">
                                            <span class="icon-globe">ğŸŒ</span> è”ç½‘æœç´¢
                                        </button>
                                    </div>
                                    <div class="chat-tools">
                                        <button class="send-btn" onclick="sendChat()">
                                            <span class="icon-arrow-up">â¬†</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="map-area">
                    <div id="seaMap" class="sea-map" style="margin-top:0; height: 100%; border: none;"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
